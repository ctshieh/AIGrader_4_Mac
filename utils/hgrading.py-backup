# Copyright (c) 2026 [è¬å¿ æ‘/Chung Tsun Shieh]. All Rights Reserved.
# This software is proprietary and confidential.
# Unauthorized copying of this file, via any medium is strictly prohibited.

def render_grading_navigation(students, questions, current_student_idx, current_question_idx):
    """
    æ¸²æŸ“é–±å·å°èˆªåˆ—ï¼Œæ”¯æ´æ°´å¹³èˆ‡å‚ç›´é–±å·åˆ‡æ›ã€‚
    """
    
    st.markdown("---")
    
    # 1. æ¨¡å¼åˆ‡æ›é–‹é—œ
    col_mode, col_nav = st.columns([1, 3])
    with col_mode:
        grading_mode = st.radio(
            "é–±å·æ¨¡å¼", 
            ["å‚ç›´ (ä¸€ä½å­¸ç”Ÿæ”¹åˆ°åº•)", "æ°´å¹³ (é–å®šé¡Œç›®æ”¹æ‰€æœ‰äºº)"],
            index=0 if st.session_state.get("grading_mode") == "vertical" else 1,
            key="radio_grading_mode"
        )
        # æ›´æ–° session state
        st.session_state.grading_mode = "vertical" if "å‚ç›´" in grading_mode else "horizontal"

    # 2. å°èˆªæŒ‰éˆ•é‚è¼¯
    with col_nav:
        c1, c2, c3 = st.columns([1, 1, 2])
        
        # ä¸Šä¸€å€‹å‹•ä½œ
        if c1.button("â¬…ï¸ Previous"):
            if st.session_state.grading_mode == "vertical":
                # å‚ç›´ï¼šä¸Šä¸€å€‹é¡Œç›®
                new_q_idx = max(0, current_question_idx - 1)
                st.session_state.current_question_idx = new_q_idx
            else:
                # æ°´å¹³ï¼šä¸Šä¸€ä½å­¸ç”Ÿ
                new_s_idx = max(0, current_student_idx - 1)
                st.session_state.current_student_idx = new_s_idx
            st.rerun()

        # ä¸‹ä¸€å€‹å‹•ä½œ
        if c2.button("Next â¡ï¸", type="primary"):
            if st.session_state.grading_mode == "vertical":
                # å‚ç›´ï¼šä¸‹ä¸€å€‹é¡Œç›®
                if current_question_idx < len(questions) - 1:
                    st.session_state.current_question_idx += 1
                else:
                    # å¦‚æœé¡Œç›®æ”¹å®Œäº†ï¼Œè‡ªå‹•è·³ä¸‹ä¸€ä½å­¸ç”Ÿ
                    if current_student_idx < len(students) - 1:
                        st.session_state.current_student_idx += 1
                        st.session_state.current_question_idx = 0
                        st.toast(f"é€™ä½æ”¹å®Œäº†ï¼åˆ‡æ›åˆ°ä¸‹ä¸€ä½ï¼š{students[current_student_idx+1]}")
                    else:
                        st.success("å…¨éƒ¨é–±å·å®Œæˆï¼")
            
            else: # æ°´å¹³æ¨¡å¼
                # æ°´å¹³ï¼šä¸‹ä¸€ä½å­¸ç”Ÿ
                if current_student_idx < len(students) - 1:
                    st.session_state.current_student_idx += 1
                else:
                    # å¦‚æœæ‰€æœ‰å­¸ç”Ÿé€™é¡Œéƒ½æ”¹å®Œäº†ï¼Œè‡ªå‹•è·³ä¸‹ä¸€é¡Œ
                    if current_question_idx < len(questions) - 1:
                        st.session_state.current_question_idx += 1
                        st.session_state.current_student_idx = 0
                        st.toast(f"é€™é¡Œå…¨æ”¹å®Œäº†ï¼åˆ‡æ›åˆ°ä¸‹ä¸€é¡Œï¼šQ{current_question_idx+2}")
                    else:
                        st.success("å…¨éƒ¨é–±å·å®Œæˆï¼")
            st.rerun()
            
        # é¡¯ç¤ºç•¶å‰é€²åº¦
        with c3:
            s_info = f"Student: {current_student_idx + 1}/{len(students)}"
            q_info = f"Question: {current_question_idx + 1}/{len(questions)}"
            st.caption(f"ğŸ“ {s_info} | {q_info}")
            # é€²åº¦æ¢
            if st.session_state.grading_mode == "horizontal":
                prog = (current_student_idx + 1) / len(students)
                st.progress(prog, text="æœ¬é¡Œæ‰¹æ”¹é€²åº¦ (æ°´å¹³)")
            else:
                prog = (current_question_idx + 1) / len(questions)
                st.progress(prog, text="æœ¬ç”Ÿæ‰¹æ”¹é€²åº¦ (å‚ç›´)")
